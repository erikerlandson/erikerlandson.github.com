
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Smooth Gradients for Cubic Hermite Splines - tool monkey</title>
  <meta name="author" content="Erik Erlandson">

  
  <meta name="description" content="One of the advantages of cubic Hermite splines is that their interval interpolation formula is an explicit function of gradients \( m_0, m_1, &#8230 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://erikerlandson.github.com/blog/2013/03/16/smooth-gradients-for-cubic-hermite-splines/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="tool monkey" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

  <!-- enables inclusion of MathJax LaTeX: http://greglus.com/blog/2011/11/29/integrate-MathJax-LaTeX-and-MathML-Markup-in-Octopress/ -->
  <script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">tool monkey</a></h1>
  
    <h2>a many-angled blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:erikerlandson.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Smooth Gradients for Cubic Hermite Splines</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-16T07:39:00-07:00" pubdate data-updated="true">Mar 16<span>th</span>, 2013</time>
        
        
         | <a href="#feedback">Feedback</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>One of the advantages of cubic Hermite splines is that their interval interpolation formula is an explicit function of gradients \( m_0, m_1, &#8230; m_{n-1} \) at knot-points:</p>

<div markdown="0">
&#92;[
y(t) = h_{00}(t) y_j + h_{10}(t) m_j + h_{01}(t) y_{j+1} + h_{11}(t) m_{j+1} &#92;&#92;
&#92;]
</div>


<p>where the Hermite bases are:</p>

<div markdown="0">
&#92;[
h_{00} = 2t^3 - 3t^2 + 1 &#92;&#92;
h_{10} = t^3 - 2t^2 + t &#92;&#92;
h_{01} = -2t^3 + 3t^2 &#92;&#92;
h_{11} = t^3 - t^2 &#92;&#92;
&#92;]
</div>


<p>(For now, I will be using the unit-interval form of the interpolation, where t runs from 0 to 1 on each interval.  I will also discuss the non-uniform interval equations below)</p>

<p>This formulation allows one to explicitly specify the interpolation gradient at each knot point, and to choose from various gradient assignment policies, for example <a href="http://en.wikipedia.org/wiki/Cubic_Hermite_spline#Interpolating_a_data_set">those listed here</a>, even supporting policies for <a href="http://en.wikipedia.org/wiki/Monotone_cubic_interpolation">enforcing monotonic interpolations</a>.</p>

<p>One important caveat with cubic Hermite splines is that although the gradient \( y&#8217;(t) \) is guaranteed to be continuous, it is <em>not</em> guaranteed to be smooth (that is, differentiable) <em>across</em> the knots (it is of course smooth <em>inside</em> each interval). Therefore, another useful category of gradient policy is to obtain gradients \( m_0, m_1, &#8230; m_{n-1} \) such that \( y&#8217;(t) \) is also smooth across knots.</p>

<p>(I feel sure that what follows was long since derived elsewhere, but my attempts to dig the formulation up on the internet failed, and so I decided the derivation might make a useful blog post)</p>

<p>To ensure smooth gradient across knot points, we want the 2nd derivative \( y&#8221;(t) \) to be equal at the boundaries of adjacent intervals:</p>

<div markdown="0">
&#92;[
h_{00}^&#8221;(t) y_{j-1} + h_{10}^&#8221;(t) m_{j-1} + h_{01}^&#8221;(t) y_j + h_{11}^&#8221;(t) m_j &#92;&#92;
= &#92;&#92;
h_{00}^&#8221;(t) y_j + h_{10}^&#8221;(t) m_j + h_{01}^&#8221;(t) y_{j+1} + h_{11}^&#8221;(t) m_{j+1}
&#92;]
</div>


<p>or substituting the 2nd derivative of the basis definitions above:</p>

<div markdown="0">
&#92;[
&#92;left( 12 t - 6 &#92;right) y_{j-1} + &#92;left( 6 t - 4 &#92;right) m_{j-1}  + &#92;left( 6 - 12 t &#92;right) y_j + &#92;left( 6 t - 2 &#92;right) m_j &#92;&#92;
= &#92;&#92;
&#92;left( 12 t - 6 &#92;right) y_{j} + &#92;left( 6 t - 4 &#92;right) m_{j}  + &#92;left( 6 - 12 t &#92;right) y_{j+1} + &#92;left( 6 t - 2 &#92;right) m_{j+1}
&#92;]
</div>


<p>Observe that t = 1 on the left hand side of this equation, and t = 0 on the right side, and so we have:</p>

<div markdown="0">
&#92;[
6 y_{j-1} + 2 m_{j-1} - 6 y_j + 4 m_j
=
-6 y_j - 4 m_j + 6 y_{j+1} - 2 m_{j+1}
&#92;]
</div>


<p>which we can rearrange as:</p>

<div markdown="0">
&#92;[
2 m_{j-1} + 8 m_j + 2 m_{j+1}
=
6 &#92;left( y_{j+1} - y_{j-1} &#92;right)
&#92;]
</div>


<p>Given n knot points, the above equation holds for j = 1 to n-2 (using zero-based indexing, as nature intended).  Once we define equations for j = 0 and j = n-1, we will have a system of equations to solve.  There are two likely choices.  The first is to simply specify the endpoint gradients \( m_0 = G \) and \( m_{n-1} = H \) directly, which yields the following <a href="http://en.wikipedia.org/wiki/Tridiagonal_matrix_algorithm">tri-diagonal matrix equation:</a></p>

<div markdown="0">
&#92;[
&#92;left( &#92;begin{array} {ccccc}
1 &   &   &   &   &#92;&#92;
2 & 8 & 2 &   &   &#92;&#92;
  & 2 & 8 & 2 &   &#92;&#92;
  &   & &#92;vdots &   &   &#92;&#92;
  &   & 2 & 8 & 2 &#92;&#92; 
  &   &   &   & 1 &#92;&#92;
&#92;end{array} &#92;right)

&#92;left( &#92;begin{array} {c}
m_0 &#92;&#92;
m_1 &#92;&#92;
 &#92;&#92;
&#92;vdots &#92;&#92;
 &#92;&#92;
m_{n-1}
&#92;end{array} &#92;right)
=
&#92;left( &#92;begin{array} {c}
G &#92;&#92;
6 &#92;left( y_2 - y_0 &#92;right) &#92;&#92;
6 &#92;left( y_3 - y_1 &#92;right) &#92;&#92;
&#92;vdots &#92;&#92;
6 &#92;left( y_{n-1} - y_{n-3} &#92;right) &#92;&#92;
H &#92;&#92;
&#92;end{array} &#92;right)
&#92;]
</div>


<p>The second common endpoint policy is to set the 2nd derivative equal to zero &#8211; the &#8220;natural spline.&#8221;   Setting the 2nd derivative to zero at the left-end knot (and t = 0) gives us:</p>

<div markdown="0">
&#92;[
4 m_0 + 2 m_1   =   6 &#92;left( y_1 - y_0 &#92;right)
&#92;]
</div>


<p>Similarly, at the right-end knot (t = 1), we have:</p>

<div markdown="0">
&#92;[
2 m_0 + 4 m_1   =   6 &#92;left( y_{n-1} - y_{n-2} &#92;right)
&#92;]
</div>


<p>And so for a natural spline endpoint policy the matrix equation looks like this:</p>

<div markdown="0">
&#92;[
&#92;left( &#92;begin{array} {ccccc}
4 & 2 &   &   &   &#92;&#92;
2 & 8 & 2 &   &   &#92;&#92;
  & 2 & 8 & 2 &   &#92;&#92;
  &   & &#92;vdots &   &   &#92;&#92;
  &   & 2 & 8 & 2 &#92;&#92; 
  &   &   & 2 & 4 &#92;&#92;
&#92;end{array} &#92;right)

&#92;left( &#92;begin{array} {c}
m_0 &#92;&#92;
m_1 &#92;&#92;
 &#92;&#92;
&#92;vdots &#92;&#92;
 &#92;&#92;
m_{n-1}
&#92;end{array} &#92;right)
=
&#92;left( &#92;begin{array} {c}
6 &#92;left( y_1 - y_0 &#92;right) &#92;&#92;
6 &#92;left( y_2 - y_0 &#92;right) &#92;&#92;
6 &#92;left( y_3 - y_1 &#92;right) &#92;&#92;
&#92;vdots &#92;&#92;
6 &#92;left( y_{n-1} - y_{n-3} &#92;right) &#92;&#92;
6 &#92;left( y_{n-1} - y_{n-2} &#92;right) &#92;&#92;
&#92;end{array} &#92;right)
&#92;]
</div>


<p>The derivation above is for uniform (and unit) intervals, where t runs from 0 to 1 on each knot interval.  I&#8217;ll now discuss the variation where knot intervals are non-uniform.   The non-uniform form of the interpolation equation is:</p>

<div markdown="0">
&#92;[
y(x) = h_{00}(t) y_j + h_{10}(t) d_j m_j + h_{01}(t) y_{j+1} + h_{11}(t) d_j m_{j+1} &#92;&#92;
&#92;text{ } &#92;&#92;
&#92;text{where:} &#92;&#92;
&#92;text{ }  &#92;&#92;
d_j = x_{j+1} - x_j &#92;text{  for  } j = 0, 1, &#8230; n-2 &#92;&#92;
t = (x - x_j) / d_j
&#92;]
</div>


<p>Taking \( t = t(x) \) and applying the chain rule, we see that 2nd derivative equation now looks like:</p>

<div markdown="0">
&#92;[
y&#8221;(x) = &#92;frac { &#92;left( 12 t - 6 &#92;right) y_{j} + &#92;left( 6 t - 4 &#92;right) d_j m_{j}  + &#92;left( 6 - 12 t &#92;right) y_{j+1} + &#92;left( 6 t - 2 &#92;right) d_j m_{j+1} } { d_j^2 }
&#92;]
</div>


<p>Applying a derivation similar to the above, we find that our (interior) equations look like this:</p>

<div markdown="0">
&#92;[
&#92;frac {2} { d_{j-1} }  m_{j-1} + &#92;left( &#92;frac {4} { d_{j-1} } + &#92;frac {4} { d_j } &#92;right) m_j + &#92;frac {2} {d_j} m_{j+1}
=
&#92;frac { 6 &#92;left( y_{j+1} - y_{j} &#92;right) } { d_j^2 } + &#92;frac { 6 &#92;left( y_{j} - y_{j-1} &#92;right) } { d_{j-1}^2 }
&#92;]
</div>


<p>and natural spline endpoint equations are:</p>

<div markdown="0">
&#92;[
&#92;text{left:  } &#92;frac {4} {d_0} m_0 + &#92;frac {2} {d_0} m_1   =   &#92;frac {6 &#92;left( y_1 - y_0 &#92;right)} {d_0^2} &#92;&#92;
&#92;text{right: } &#92;frac {2} {d_{n-2}} m_0 + &#92;frac {4} {d_{n-2}} m_1   =   &#92;frac {6 &#92;left( y_{n-1} - y_{n-2} &#92;right)} {d_{n-2}^2}
&#92;]
</div>


<p>And so the matrix equation for specified endpoint gradients is:</p>

<div markdown="0">
&#92;[
&#92;scriptsize
&#92;left( &#92;begin{array} {ccccc}
&#92;normalsize 1 &#92;scriptsize &   &   &   &   &#92;&#92;
&#92;frac{2}{d_0} & &#92;frac{4}{d_0} {+} &#92;frac{4}{d_1} & &#92;frac{2}{d_1} &   &   &#92;&#92;
  & &#92;frac{2}{d_1} & &#92;frac{4}{d_1} {+} &#92;frac{4}{d_2} & &#92;frac{2}{d_2} &   &#92;&#92;
  &   & &#92;vdots &   &   &#92;&#92;
  &   & &#92;frac{2}{d_{n-3}} & &#92;frac{4}{d_{n-3}} {+} &#92;frac{4}{d_{n-2}} & &#92;frac{2}{d_{n-2}} &#92;&#92; 
  &   &   &   & &#92;normalsize 1 &#92;scriptsize &#92;&#92;
&#92;end{array} &#92;right)

&#92;left( &#92;begin{array} {c}
m_0 &#92;&#92;
m_1 &#92;&#92;
 &#92;&#92;
&#92;vdots &#92;&#92;
 &#92;&#92;
m_{n-1}
&#92;end{array} &#92;right)
=
&#92;left( &#92;begin{array} {c}
G &#92;&#92;
6 &#92;left( &#92;frac{y_2 {-} y_1}{d_1^2} {+} &#92;frac{y_1 {-} y_0}{d_0^2} &#92;right) &#92;&#92;
6 &#92;left( &#92;frac{y_3 {-} y_2}{d_2^2} {+} &#92;frac{y_2 {-} y_1}{d_1^2} &#92;right)  &#92;&#92;
&#92;vdots &#92;&#92;
6 &#92;left( &#92;frac{y_{n-1} {-} y_{n-2}}{d_{n-2}^2} {+} &#92;frac{y_{n-2} {-} y_{n-3}}{d_{n-3}^2} &#92;right) &#92;&#92;
H &#92;&#92;
&#92;end{array} &#92;right)
&#92;normalsize
&#92;]
</div>


<p>And the equation for natural spline endpoints is:</p>

<div markdown="0">
&#92;[
&#92;scriptsize
&#92;left( &#92;begin{array} {ccccc}
&#92;frac{4}{d_0} & &#92;frac{2}{d_0}  &   &   &   &#92;&#92;
&#92;frac {2} {d_0} & &#92;frac {4} {d_0} {+} &#92;frac {4} {d_1} & &#92;frac{2}{d_1} &   &   &#92;&#92;
  & &#92;frac{2}{d_1} & &#92;frac{4}{d_1} {+} &#92;frac{4}{d_2} & &#92;frac{2}{d_2} &   &#92;&#92;
  &   & &#92;vdots &   &   &#92;&#92;
  &   & &#92;frac{2}{d_{n-3}} & &#92;frac{4}{d_{n-3}} {+} &#92;frac{4}{d_{n-2}} & &#92;frac{2}{d_{n-2}} &#92;&#92; 
  &   &   & &#92;frac{2}{d_{n-2}} & &#92;frac{4}{d_{n-2}} &#92;&#92;
&#92;end{array} &#92;right)

&#92;left( &#92;begin{array} {c}
m_0 &#92;&#92;
m_1 &#92;&#92;
 &#92;&#92;
&#92;vdots &#92;&#92;
 &#92;&#92;
m_{n-1}
&#92;end{array} &#92;right)
=
&#92;left( &#92;begin{array} {c}
&#92;frac{6 &#92;left( y_1 {-} y_0 &#92;right)}{d_0^2} &#92;&#92;
6 &#92;left( &#92;frac{y_2 {-} y_1}{d_1^2}  {+}  &#92;frac{y_1 {-} y_0}{d_0^2} &#92;right) &#92;&#92;
6 &#92;left( &#92;frac{y_3 {-} y_2}{d_2^2}  {+}  &#92;frac{y_2 {-} y_1}{d_1^2} &#92;right)  &#92;&#92;
&#92;vdots &#92;&#92;
6 &#92;left( &#92;frac{y_{n-1} {-} y_{n-2}}{d_{n-2}^2}  {+}  &#92;frac{y_{n-2} {-} y_{n-3}}{d_{n-3}^2} &#92;right) &#92;&#92;
&#92;frac{6 &#92;left( y_{n-1} {-} y_{n-2} &#92;right)}{d_{n-2}^2} &#92;&#92;
&#92;end{array} &#92;right)
&#92;normalsize
&#92;]
</div>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Erik Erlandson</span></span>

      








  


<time datetime="2013-03-16T07:39:00-07:00" pubdate data-updated="true">Mar 16<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/computing/'>computing</a>, <a class='category' href='/blog/categories/cubic-hermite-spline/'>cubic hermite spline</a>, <a class='category' href='/blog/categories/gradient/'>gradient</a>, <a class='category' href='/blog/categories/math/'>math</a>, <a class='category' href='/blog/categories/spline/'>spline</a>
  
</span>


      <br>
<a id="feedback"></a>Feedback • 
 
    <script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
    
  <a href="https://twitter.com/intent/tweet?text=@manyangled%20re:%20http://erikerlandson.github.com/blog/2013/03/16/smooth-gradients-for-cubic-hermite-splines/">Reply to this post on Twitter</a> • 
 
<a href="mailto:erikerlandson@yahoo.com">Email the author</a>

    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://erikerlandson.github.com/blog/2013/03/16/smooth-gradients-for-cubic-hermite-splines/" data-via="manyangled" data-counturl="http://erikerlandson.github.com/blog/2013/03/16/smooth-gradients-for-cubic-hermite-splines/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/03/15/examining-the-modulus-of-random-variables/" title="Previous Post: Examining the Modulus of Random Variables">&laquo; Examining the Modulus of Random Variables</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/03/21/the-impact-of-negotiator-cycle-cadence-on-slot-loading/" title="Next Post: The Impact of Negotiator Cycle Cadence on Slot Loading">The Impact of Negotiator Cycle Cadence on Slot Loading &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About The Author</h1>
  <p>Erik is a senior software engineer on the <a href="http://www.redhat.com">Red Hat</a> Big Data Group.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/01/24/monadic-break-and-continue-for-scala-sequence-comprehensions/">Monadic 'break' and 'continue' for Scala Sequence Comprehensions</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/11/faster-random-samples-with-gap-sampling/">Faster Random Samples With Gap Sampling</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/03/matryoshka-class-construction-from-the-scala-iterator-drop-method/">The Scala Iterator 'drop' Method Generates a Matryoshka Class Nesting</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/12/implementing-parallel-prefix-scan-as-a-spark-rdd-transform/">Implementing Parallel Prefix Scan as a Spark RDD Transform</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/09/implementing-an-rdd-scanleft-transform-with-cascade-rdds/">Implementing an RDD scanLeft Transform With Cascade RDDs</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/erikerlandson">@erikerlandson</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'erikerlandson',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("manyangled", 4, true);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/manyangled" class="twitter-follow-button" data-show-count="false">Follow @manyangled</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Erik Erlandson -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
